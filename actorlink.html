<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" type="text/css" href="actorlinkstyles.css">
    <title>Actor Link</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  </head>
  <body>
    <div class="names">
      <h3 id="name_one" class="name"></h3>
      <div class="connecting-line"></div>
      <h3 id="name_two" class="name"></h3>
    </div>
    <div class="box">
      <div class="containerOne" id="one">
        <h1 id="first_name" class="actor"></h1>
        <img src="" id="first_poster" class="main-poster">
        <h1 id="movie_title" class="actor"></h1>
        <hr>
      </div>
      <div class="containerTwo">
    
        <input type="text" id="queryOne" class="autocomplete" placeholder="Enter actor's name or movie"/>
        <button id="searchBtn" class="btn">Search</button><br><br>
    
    </div>
    <div class="containerHide">
        <button id="show" class="btn">Show/Hide</button>
    </div>
      <div class="containerThree" id="two"></div>
    </div>
    <script>
      // ... Your existing code ...
      document.addEventListener("DOMContentLoaded", function() {
        const options = {
          method: 'GET',
          headers: {
            accept: 'application/json',
            Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJhNjBiNWNhZmM3YjZiMmZiYzA2MjZkZjA1NWFlMmQ2MiIsInN1YiI6IjY1YzM4Y2IyM2ZlNzk3MDE4M2ZlZjkyNyIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.VBXEhhJA_kJuU1uRe2OOZ7NzIyJwWzOwgz2ZcerG9zM'
          }
        };

        function clickHandledMovie(array) {
            let queryOne = $('#queryOne').val();

            // Search for the movie in filmArray that matches the queryOne
            let foundMovie = array.find(movie => movie[0] === queryOne);

            $('#queryOne').val("");

            if (foundMovie) {
                // If a match is found, handle the click with the corresponding ID
                handleMovieClick(foundMovie[2]);
            } else {
                // Handle the case when no match is found
                alert('Movie not found');
            }
        }

        function clickHandledActor() {
            let queryOne = $('#queryOne').val();

            $('#queryOne').val("");

            handleActorClick(queryOne);
        }

        let btn = document.getElementById("searchBtn")


        async function getActors() {
          pageCount = 1;
          let actorArray = [];
          for (var i = 0; i < 10; i++) {
            const response = await fetch('https://api.themoviedb.org/3/person/popular?language=en-US&page=' + pageCount, options);
            const data = await response.json();
            actorArray = actorArray.concat(data.results.map(actor => actor.name));
            pageCount += 1;
          }
          return actorArray;
        }
        async function exampleUsage() {
          const celebs = await getActors();
          console.log(celebs); // Now it should not be undefined
          let actorOne;
          let actorTwo;
          actorOne = celebs[Math.floor(Math.random() * celebs.length)];
          actorTwo = celebs[Math.floor(Math.random() * celebs.length)];
          $('#name_one').html(actorOne);
          $('#name_two').html(actorTwo);
          // Set up autocomplete for input fields
          $(".autocomplete").autocomplete({
            source: celebs,
            minLength: 2, // Minimum characters before suggestions are shown
            delay: 300, // Delay in milliseconds before making the request
          });
          let nameOne = actorOne;
          let nameTwo = actorTwo;
          let idOne;
          let idTwo;
          let profOne;
          let oneMovie;
          let oneCast;
          let commonMovie;
          var arrayID = [];
          var arrayTitle = [];
          var arrayPoster = [];
          var arrayYear = [];
          let twoMovie;
          var arrayTwo = [];
          var arrayActorID = [];
          var arrayName = [];
          var arrayProfile = [];
          let currentMovie;
          let currentActor;
          let btn = document.getElementById("searchBtn");
          let btnShow = document.getElementById("show");
          let listContent = document.getElementById("two");
          currentActor = actorOne;
          let movieClickListenerAdded = false;
          let isShowing = false;

          function hideList(){
            if(!isShowing){
                listContent.style.display = "grid";
                isShowing = true;
            } else{
                listContent.style.display = "none";
                isShowing = false;
            }
          }

          // Function to handle movie click
          function handleMovieClick(movieID) {

            // Clear the page
            clearPage();
            // Run getCast function with the selected movieID
            getCast(movieID);
          }
          // Function to handle actor click
          function handleActorClick(actorName) {
            if (actorName == actorTwo) {
              const endTime = new Date().getTime();
              const elapsedTimeInSeconds = (endTime - startTime) / 1000;
              const minutes = Math.floor(elapsedTimeInSeconds / 60);
              const seconds = Math.floor(elapsedTimeInSeconds % 60);
              const formattedTime = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
              alert("Congratulations, you win! Time: " + formattedTime)
              location.reload();
            }
            // Clear the page
            clearPage();
            // Run getMovies function with the selected actorName
            getMovies(actorName);
          }
          // Clear the content of the page
          function clearPage() {

            let name = document.getElementById("first_name");
            let poster = document.getElementById("first_poster");
            let title = document.getElementById("movie_title");
            let content = document.getElementById("two")
            name.innerHTML = "";
            title.innerHTML = "";
            poster.setAttribute("src", "");
            content.innerHTML = "";
          }

          function getMovies(actor) {

            btnShow.onclick = function() {hideList()};
 
            arrayID = [];
            arrayTitle = [];
            arrayPoster = [];
            arrayYear = [];
            selectedActor = actor;
            fetch('https://api.themoviedb.org/3/search/person?query=' + selectedActor + '&include_adult=false&language=en-US&page=1', options).then(response => response.json()).then(response => {
              idOne = response.results[0].id;
              profOne = response.results[0].profile_path ? "https://image.tmdb.org/t/p/w500" + response.results[0].profile_path : 'actor.png'; // Replace 'path_to_default_image.jpg' with your default image path
              fetch('https://api.themoviedb.org/3/person/' + idOne + '/movie_credits?language=en-US', options).then(response => response.json()).then(response => {
                oneMovie = response;
                for (var i = 0; i < oneMovie.cast.length; i++) {
                  arrayID.push(oneMovie.cast[i].id)
                  arrayTitle.push(oneMovie.cast[i].title)
                  arrayYear.push(parseInt(oneMovie.cast[i].release_date.substr(0, 4)))
                  let movImg = oneMovie.cast[i].poster_path ? "https://image.tmdb.org/t/p/w500" + oneMovie.cast[i].poster_path : 'movie.png'; // Replace 'path_to_default_image.jpg' with your default image path
                  arrayPoster.push(movImg)
                }
                $('#first_name').html(actor)
                const img = document.getElementById("first_poster");
                img.setAttribute('src', profOne)
                let filmArray = arrayTitle.map((e, i) => [e, arrayYear[i], arrayID[i], arrayPoster[i]]);
                filmArray.sort((a, b) => b[1] - a[1]);
                let count = 0;
                let divTwo = document.getElementById("two")
                // Modify the display of movies to make them clickable
                for (let i = 0; i < filmArray.length; i++) {
                  const newDiv = document.createElement("div");
                  newDiv.setAttribute("class", "cont");
                  const img = document.createElement("img");
                  img.setAttribute("src", filmArray[i][3]);
                  img.setAttribute("id", "poster");
                  img.setAttribute("class", "poster");
                  const h2 = document.createElement("h2");
                  const title = document.createTextNode(filmArray[i][0]);
                  h2.appendChild(title);
                  const p = document.createElement("p");
                  const year = document.createTextNode(filmArray[i][1]);
                  p.appendChild(year);

                  
                  // Make the movie clickable using a closure
                  newDiv.addEventListener("click", (function(index) {
                    return function() {
                      handleMovieClick(filmArray[index][2]);
                    };
                  })(i));
                  newDiv.appendChild(img);
                  newDiv.appendChild(h2);
                  newDiv.appendChild(p);
                  divTwo.appendChild(newDiv);

                  // Set up autocomplete for input fields
                    $(".autocomplete").autocomplete({
                        source: arrayTitle,
                        minLength: 2, // Minimum characters before suggestions are shown
                        delay: 300,   // Delay in milliseconds before making the request
                    });
                }


                function clickHandledMovie(){
                    let queryOne = $('#queryOne').val();

                    // Search for the movie in filmArray that matches the queryOne
                    let foundMovie = filmArray.find(movie => movie[0] === queryOne);

                    $('#queryOne').val("");

                    if (foundMovie) {
                        // If a match is found, handle the click with the corresponding ID
                        handleMovieClick(foundMovie[2]);
                    } else {
                        // Handle the case when no match is found
                        alert('Movie not found');
                    }
              
                }

                btn.onclick = function() {clickHandledMovie()};

                
              }).catch(err => console.error(err));
            }).catch(err => {
              console.error(err)
              $('#queryOne').val("")
            });
          }

          function getCast(movie) {
            arrayActorID = [];
            arrayName = [];
            arrayProfile = [];
            let movieID = movie;
            fetch('https://api.themoviedb.org/3/movie/' + movieID + '/credits?language=en-US', options).then(response => response.json()).then(response => {
              oneCast = response;
              for (var i = 0; i < oneCast.cast.length; i++) {
                arrayActorID.push(oneCast.cast[i].id)
                arrayName.push(oneCast.cast[i].name)
                let profImg = oneCast.cast[i].profile_path ? "https://image.tmdb.org/t/p/w500" + oneCast.cast[i].profile_path : 'actor.png'; // Replace 'path_to_default_image.jpg' with your default image path
                arrayProfile.push(profImg)
              }
              fetch('https://api.themoviedb.org/3/movie/' + movieID + '?language=en-US', options).then(response => response.json()).then(response => {
                let movieTitle = response.title;
                let imgPath = response.poster_path ? "https://image.tmdb.org/t/p/w500" + response.poster_path : 'movie.png'; // Replace 'path_to_default_image.jpg' with your default image path
                $('#movie_title').html(movieTitle)
                const img = document.getElementById("first_poster");
                img.setAttribute('src', imgPath)
              }).catch(err => console.error(err));
              let castArray = arrayName.map((e, i) => [e, arrayActorID[i], arrayProfile[i]]);
              let divTwo = document.getElementById("two")
              for (let i = 0; i < castArray.length; i++) {
                const newDiv = document.createElement("div");
                newDiv.setAttribute("class", "cont");
                const img = document.createElement("img");
                img.setAttribute("src", castArray[i][2]);
                img.setAttribute("id", "poster");
                img.setAttribute("class", "poster");
                const h2 = document.createElement("h2");
                const title = document.createTextNode(castArray[i][0]);
                h2.appendChild(title);
                // Make the actor clickable using a closure
                newDiv.addEventListener("click", (function(index) {
                  return function() {
                    handleActorClick(castArray[index][0]);
                  };
                })(i));
                newDiv.appendChild(img);
                newDiv.appendChild(h2);
                divTwo.appendChild(newDiv);

                

                // Set up autocomplete for input fields
                $(".autocomplete").autocomplete({
                    source: arrayName,
                    minLength: 2, // Minimum characters before suggestions are shown
                    delay: 300,   // Delay in milliseconds before making the request
                });
              }

              function clickHandledActor(){
                let queryOne=$('#queryOne').val();

                $('#queryOne').val("");

                handleActorClick(queryOne);
                }

                btn.onclick = function() {clickHandledActor()};


            }).catch(err => console.error(err));
          }
          startTime = new Date().getTime();
          getMovies(actorOne);
        }
        exampleUsage();
      });
    </script>
  </body>
</html>
